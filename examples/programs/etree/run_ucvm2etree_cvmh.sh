#!/bin/bash

if [ -z "$UCVM_INSTALL_PATH" ]; then
  echo "Need to set UCVM_INSTALL_PATH to run >" ${0##*/} 
  exit
fi

BIN_DIR=${UCVM_INSTALL_PATH}/bin
CONF_DIR=${UCVM_INSTALL_PATH}/conf

expect=$(mktemp) || exit 1
result=$(mktemp) || (trap 'rm -f "$expect"'; exit 1)

sed 's ${CONF_DIR} '$CONF_DIR' ' garnervalley_cvmh.conf_template > garnervalley_cvmh.conf

${BIN_DIR}/ucvm2etree -f ./garnervalley_cvmh.conf > garnervalley_cvmh.out

head -1 garnervalley_cvmh_nogtl_0.5hz_10pts_1000ms.e |od |head -20 > $result

cat > $expect << EOF_EXPECTED_RESULT
0000000 000514 000000 001400 000000 000000 000000 146400 000000
0000020 000000 000000 000000 000000 000000 000000 000000 000000
*
0000100 100000 000115 000000 000000 000000 000222 000000 000000
0000120 000000 000020 000000 000000 000000 000000 000000 000000
0000140 000000 000000 000000 000000 000000 000000 000000 000000
*
0000420 046000 010000 000000 001164 000000 000000 000000 000001
0000440 000000 000000 000000 000015 000000 000014 000000 000061
0000460 000000 020114 020063 070126 063040 067554 072141 032040
0000500 030040 053040 020163 066146 060557 020164 020064 020064
0000520 062544 071556 072151 020171 066146 060557 020164 020064
0000540 020070 000000 000000 000000 000000 000000 000000 000000
0000560 000000 000000 000000 000000 000000 000000 000000 000000
*
0010000 177777 177777 177777 177777 000000 000000 000000 000000
0010020 000006 000000 177777 177777 000151 000000 000000 000000
0010040 000000 000000 000000 000304 000000 000000 000000 000206
0010060 000000 000000 000000 000000 136620 142400 000000 000000
0010100 000000 103400 000000 000000 000000 000000 164000 002024
EOF_EXPECTED_RESULT

echo "Running examples_programs_ucvm2etree ucvm2etree_cvmh"
if diff $result $expect > /dev/null 2>&1
then
  echo [SUCCESS]
else
  echo [FAILURE]
fi

trap 'rm -f "$expect" "$result"' exit

