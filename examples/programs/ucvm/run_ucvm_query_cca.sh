#!/bin/bash

if [ -z "$UCVM_INSTALL_PATH" ]; then
  echo "Need to set UCVM_INSTALL_PATH to run >" ${0##*/} 
  exit
fi
source $UCVM_INSTALL_PATH/conf/ucvm_env.sh

BIN_DIR=${UCVM_INSTALL_PATH}/bin
CONF_DIR=${UCVM_INSTALL_PATH}/conf
TEST_DIR=${UCVM_INSTALL_PATH}/tests/inputs
MODEL=cca

expect=$(mktemp) || exit 1
result=$(mktemp) || (trap 'rm -f "$expect"'; exit 1)

${BIN_DIR}/ucvm_query -m ${MODEL} -f ${CONF_DIR}/ucvm.conf < ${TEST_DIR}/test_latlons.txt  > $result 2>&1
${BIN_DIR}/ucvm_query -m ${MODEL} -f ${CONF_DIR}/ucvm.conf < ${TEST_DIR}/test_latlons_cca_gd.txt  >> $result 2>&1

cat > $expect << EOF_EXPECTED_RESULT
Using Geo Depth coordinates as default mode.
 -118.0000    34.0000      0.000    281.668    468.400       none      0.000      0.000      0.000       none      0.000      0.000      0.000       none      0.000      0.000      0.000
 -118.0000    34.0000     50.000    281.668    468.400       none      0.000      0.000      0.000       none      0.000      0.000      0.000       none      0.000      0.000      0.000
 -118.0000    34.0000    100.000    281.668    468.400       none      0.000      0.000      0.000       none      0.000      0.000      0.000       none      0.000      0.000      0.000
 -118.0000    34.0000    500.000    281.668    468.400       none      0.000      0.000      0.000       none      0.000      0.000      0.000       none      0.000      0.000      0.000
 -118.0000    34.0000   1000.000    281.668    468.400       none      0.000      0.000      0.000       none      0.000      0.000      0.000       none      0.000      0.000      0.000
Using Geo Depth coordinates as default mode.
 -118.7950    36.4140      0.000   1806.117    710.100        cca   5376.383   3055.313   2544.514       none      0.000      0.000      0.000      crust   5376.383   3055.313   2544.514
 -118.7950    36.4140    500.000   1806.117    710.100        cca   5369.793   3051.247   2543.275       none      0.000      0.000      0.000      crust   5369.793   3051.247   2543.275
 -118.7950    36.4140   1000.000   1806.117    710.100        cca   5345.761   3036.707   2538.881       none      0.000      0.000      0.000      crust   5345.761   3036.707   2538.881
 -118.7950    36.4140   3000.000   1806.117    710.100        cca   5547.681   3174.190   2582.957       none      0.000      0.000      0.000      crust   5547.681   3174.190   2582.957
 -118.7950    36.4140   5000.000   1806.117    710.100        cca   5955.416   3471.190   2697.707       none      0.000      0.000      0.000      crust   5955.416   3471.190   2697.707
 -120.0850    37.2060      0.000    122.967    468.400        cca   4273.378   2465.605   2409.900       none      0.000      0.000      0.000      crust   4273.378   2465.605   2409.900
 -120.0850    37.2060    500.000    122.967    468.400        cca   4797.399   2787.089   2472.783       none      0.000      0.000      0.000      crust   4797.399   2787.089   2472.783
 -120.0850    37.2060   1000.000    122.967    468.400        cca   5097.845   2976.205   2521.272       none      0.000      0.000      0.000      crust   5097.845   2976.205   2521.272
 -120.0850    37.2060   3000.000    122.967    468.400        cca   5459.694   3125.611   2566.734       none      0.000      0.000      0.000      crust   5459.694   3125.611   2566.734
 -120.0850    37.2060   5000.000    122.967    468.400        cca   5520.030   3151.535   2575.304       none      0.000      0.000      0.000      crust   5520.030   3151.535   2575.304
 -121.4440    36.2370      0.000    232.856    385.100        cca   2728.356   1533.677   2267.897       none      0.000      0.000      0.000      crust   2728.356   1533.677   2267.897
 -121.4440    36.2370    500.000    232.856    385.100        cca   4108.156   2265.624   2379.571       none      0.000      0.000      0.000      crust   4108.156   2265.624   2379.571
 -121.4440    36.2370   1000.000    232.856    385.100        cca   4833.439   2869.134   2492.614       none      0.000      0.000      0.000      crust   4833.439   2869.134   2492.614
 -121.4440    36.2370   3000.000    232.856    385.100        cca   5826.764   3487.293   2704.668       none      0.000      0.000      0.000      crust   5826.764   3487.293   2704.668
 -121.4440    36.2370   5000.000    232.856    385.100        cca   5956.785   3560.825   2737.451       none      0.000      0.000      0.000      crust   5956.785   3560.825   2737.451
 -120.4870    34.2220      0.000   -252.000    180.000        cca   5104.342   2872.431   2493.449       none      0.000      0.000      0.000      crust   5104.342   2872.431   2493.449
 -120.4870    34.2220    500.000   -252.000    180.000        cca   5104.621   2872.347   2493.427       none      0.000      0.000      0.000      crust   5104.621   2872.347   2493.427
 -120.4870    34.2220   1000.000   -252.000    180.000        cca   5118.701   2880.301   2495.453       none      0.000      0.000      0.000      crust   5118.701   2880.301   2495.453
 -120.4870    34.2220   3000.000   -252.000    180.000        cca   5374.167   3040.999   2540.167       none      0.000      0.000      0.000      crust   5374.167   3040.999   2540.167
 -120.4870    34.2220   5000.000   -252.000    180.000        cca   5625.577   3174.690   2583.118       none      0.000      0.000      0.000      crust   5625.577   3174.690   2583.118
 -121.8143    36.6509      0.000     43.731    307.600        cca   2482.127   1417.983   2241.754       none      0.000      0.000      0.000      crust   2482.127   1417.983   2241.754
 -121.8143    36.6509    500.000     43.731    307.600        cca   2906.602   1660.090   2292.189       none      0.000      0.000      0.000      crust   2906.602   1660.090   2292.189
 -121.8143    36.6509   1000.000     43.731    307.600        cca   3494.539   2016.444   2345.838       none      0.000      0.000      0.000      crust   3494.539   2016.444   2345.838
 -121.8143    36.6509   3000.000     43.731    307.600        cca   5641.579   3388.198   2662.956       none      0.000      0.000      0.000      crust   5641.579   3388.198   2662.956
 -121.8143    36.6509   5000.000     43.731    307.600        cca   5890.460   3530.950   2723.946       none      0.000      0.000      0.000      crust   5890.460   3530.950   2723.946
EOF_EXPECTED_RESULT

echo "Running examples_programs_ucvm ucvm_query_cca"
if diff $result $expect > /dev/null 2>&1
then
  echo [SUCCESS]
else
  echo [FAILURE]
fi

trap 'rm -f "$expect" "$result"' exit

