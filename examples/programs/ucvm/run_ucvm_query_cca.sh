#!/bin/bash

if [ -z "$UCVM_INSTALL_PATH" ]; then
  echo "Need to set UCVM_INSTALL_PATH to run >" ${0##*/} 
  exit
fi
source $UCVM_INSTALL_PATH/conf/ucvm_env.sh

BIN_DIR=${UCVM_INSTALL_PATH}/bin
CONF_DIR=${UCVM_INSTALL_PATH}/conf
TEST_DIR=${UCVM_INSTALL_PATH}/tests/inputs
MODEL=cca

expect=$(mktemp) || exit 1
result=$(mktemp) || (trap 'rm -f "$expect"'; exit 1)

${BIN_DIR}/ucvm_query -m ${MODEL} -f ${CONF_DIR}/ucvm.conf < ${TEST_DIR}/test_latlons_cca.txt  > $result 2>&1

cat > $expect << EOF_EXPECTED_RESULT
Using Geo Depth coordinates as default mode.
 -118.7950    36.4140      0.000   1806.117    710.100        cca   5376.604   3055.442   2544.554       none      0.000      0.000      0.000      crust   5376.604   3055.442   2544.554
 -118.7950    36.4140    500.000   1806.117    710.100        cca   5370.010   3051.372   2543.313       none      0.000      0.000      0.000      crust   5370.010   3051.372   2543.313
 -118.7950    36.4140   1000.000   1806.117    710.100        cca   5345.950   3036.808   2538.912       none      0.000      0.000      0.000      crust   5345.950   3036.808   2538.912
 -118.9750    36.4140   3000.000    331.162    710.100        cca   5692.839   3362.836   2652.748       none      0.000      0.000      0.000      crust   5692.839   3362.836   2652.748
 -118.9750    36.4140   5000.000    331.162    710.100        cca   5866.263   3420.456   2676.229       none      0.000      0.000      0.000      crust   5866.263   3420.456   2676.229
 -120.0850    37.2060      0.000    122.967    468.400        cca   4272.941   2465.268   2409.844       none      0.000      0.000      0.000      crust   4272.941   2465.268   2409.844
 -120.0850    37.2060    500.000    122.967    468.400        cca   4796.681   2786.662   2472.683       none      0.000      0.000      0.000      crust   4796.681   2786.662   2472.683
 -120.0850    37.2060   1000.000    122.967    468.400        cca   5097.260   2975.843   2521.169       none      0.000      0.000      0.000      crust   5097.260   2975.843   2521.169
 -120.0850    37.2060   3000.000    122.967    468.400        cca   5459.453   3125.438   2566.677       none      0.000      0.000      0.000      crust   5459.453   3125.438   2566.677
 -120.0850    37.2060   5000.000    122.967    468.400        cca   5519.877   3151.389   2575.254       none      0.000      0.000      0.000      crust   5519.877   3151.389   2575.254
 -121.4440    36.2370      0.000    232.856    385.100        cca   2728.451   1533.734   2267.909       none      0.000      0.000      0.000      crust   2728.451   1533.734   2267.909
 -121.4440    36.2370    500.000    232.856    385.100        cca   4108.424   2265.765   2379.591       none      0.000      0.000      0.000      crust   4108.424   2265.765   2379.591
 -121.4440    36.2370   1000.000    232.856    385.100        cca   4833.572   2869.208   2492.633       none      0.000      0.000      0.000      crust   4833.572   2869.208   2492.633
 -121.4440    36.2370   3000.000    232.856    385.100        cca   5826.893   3487.394   2704.712       none      0.000      0.000      0.000      crust   5826.893   3487.394   2704.712
 -121.4440    36.2370   5000.000    232.856    385.100        cca   5956.958   3560.970   2737.517       none      0.000      0.000      0.000      crust   5956.958   3560.970   2737.517
 -120.4870    34.2220      0.000   -252.000    180.000        cca   5104.531   2872.584   2493.487       none      0.000      0.000      0.000      crust   5104.531   2872.584   2493.487
 -120.4870    34.2220    500.000   -252.000    180.000        cca   5104.811   2872.500   2493.466       none      0.000      0.000      0.000      crust   5104.811   2872.500   2493.466
 -120.4870    34.2220   1000.000   -252.000    180.000        cca   5118.893   2880.458   2495.493       none      0.000      0.000      0.000      crust   5118.893   2880.458   2495.493
 -120.4870    34.2220   3000.000   -252.000    180.000        cca   5374.364   3041.156   2540.214       none      0.000      0.000      0.000      crust   5374.364   3041.156   2540.214
 -120.4870    34.2220   5000.000   -252.000    180.000        cca   5625.756   3174.824   2583.164       none      0.000      0.000      0.000      crust   5625.756   3174.824   2583.164
EOF_EXPECTED_RESULT

echo "Running examples_programs_ucvm ucvm_query_cca"
if diff $result $expect > /dev/null 2>&1
then
  echo [SUCCESS]
else
  echo [FAILURE]
fi

trap 'rm -f "$expect" "$result"' exit

