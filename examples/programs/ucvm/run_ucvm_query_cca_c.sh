#!/bin/bash

if [ -z "$UCVM_INSTALL_PATH" ]; then
  echo "Need to set UCVM_INSTALL_PATH to run >" ${0##*/} 
  exit
fi
source $UCVM_INSTALL_PATH/conf/ucvm_env.sh

BIN_DIR=${UCVM_INSTALL_PATH}/bin
CONF_DIR=${UCVM_INSTALL_PATH}/conf
TEST_DIR=${UCVM_INSTALL_PATH}/tests/inputs
MODEL=cca

expect=$(mktemp) || exit 1
result=$(mktemp) || (trap 'rm -f "$expect"'; exit 1)

${BIN_DIR}/ucvm_query -c gd -m ${MODEL} -f ${CONF_DIR}/ucvm.conf < ${TEST_DIR}/test_latlons_cca_gd.txt  > $result 2>&1
${BIN_DIR}/ucvm_query -c ge -m ${MODEL} -f ${CONF_DIR}/ucvm.conf < ${TEST_DIR}/test_latlons_cca_ge.txt  >> $result 2>&1

cat > $expect << EOF_EXPECTED_RESULT
Using Geo Depth coordinates as z mode.
 -118.7950    36.4140      0.000   1798.774    710.100        cca   5376.604   3055.442   2544.554       none      0.000      0.000      0.000      crust   5376.604   3055.442   2544.554
 -118.7950    36.4140    500.000   1798.774    710.100        cca   5370.010   3051.372   2543.313       none      0.000      0.000      0.000      crust   5370.010   3051.372   2543.313
 -118.7950    36.4140   1000.000   1798.774    710.100        cca   5345.950   3036.808   2538.912       none      0.000      0.000      0.000      crust   5345.950   3036.808   2538.912
 -118.7950    36.4140   3000.000   1798.774    710.100        cca   5547.683   3174.135   2582.938       none      0.000      0.000      0.000      crust   5547.683   3174.135   2582.938
 -118.7950    36.4140   5000.000   1798.774    710.100        cca   5955.242   3471.005   2697.626       none      0.000      0.000      0.000      crust   5955.242   3471.005   2697.626
 -120.0850    37.2060      0.000    122.967    517.530        cca   4272.941   2465.268   2409.844       none      0.000      0.000      0.000      crust   4272.941   2465.268   2409.844
 -120.0850    37.2060    500.000    122.967    517.530        cca   4796.681   2786.662   2472.683       none      0.000      0.000      0.000      crust   4796.681   2786.662   2472.683
 -120.0850    37.2060   1000.000    122.967    517.530        cca   5097.260   2975.843   2521.169       none      0.000      0.000      0.000      crust   5097.260   2975.843   2521.169
 -120.0850    37.2060   3000.000    122.967    517.530        cca   5459.453   3125.438   2566.677       none      0.000      0.000      0.000      crust   5459.453   3125.438   2566.677
 -120.0850    37.2060   5000.000    122.967    517.530        cca   5519.877   3151.389   2575.254       none      0.000      0.000      0.000      crust   5519.877   3151.389   2575.254
 -121.4440    36.2370      0.000    239.454    385.100        cca   2728.451   1533.734   2267.909       none      0.000      0.000      0.000      crust   2728.451   1533.734   2267.909
 -121.4440    36.2370    500.000    239.454    385.100        cca   4108.424   2265.765   2379.591       none      0.000      0.000      0.000      crust   4108.424   2265.765   2379.591
 -121.4440    36.2370   1000.000    239.454    385.100        cca   4833.572   2869.208   2492.633       none      0.000      0.000      0.000      crust   4833.572   2869.208   2492.633
 -121.4440    36.2370   3000.000    239.454    385.100        cca   5826.893   3487.394   2704.712       none      0.000      0.000      0.000      crust   5826.893   3487.394   2704.712
 -121.4440    36.2370   5000.000    239.454    385.100        cca   5956.958   3560.970   2737.517       none      0.000      0.000      0.000      crust   5956.958   3560.970   2737.517
 -120.4870    34.2220      0.000   -252.000    180.000        cca   5104.531   2872.584   2493.487       none      0.000      0.000      0.000      crust   5104.531   2872.584   2493.487
 -120.4870    34.2220    500.000   -252.000    180.000        cca   5104.811   2872.500   2493.466       none      0.000      0.000      0.000      crust   5104.811   2872.500   2493.466
 -120.4870    34.2220   1000.000   -252.000    180.000        cca   5118.893   2880.458   2495.493       none      0.000      0.000      0.000      crust   5118.893   2880.458   2495.493
 -120.4870    34.2220   3000.000   -252.000    180.000        cca   5374.364   3041.156   2540.214       none      0.000      0.000      0.000      crust   5374.364   3041.156   2540.214
 -120.4870    34.2220   5000.000   -252.000    180.000        cca   5625.756   3174.824   2583.164       none      0.000      0.000      0.000      crust   5625.756   3174.824   2583.164
 -121.8143    36.6509      0.000     43.756    313.533        cca   2482.287   1418.074   2241.776       none      0.000      0.000      0.000      crust   2482.287   1418.074   2241.776
 -121.8143    36.6509    500.000     43.756    313.533        cca   2907.048   1660.351   2292.235       none      0.000      0.000      0.000      crust   2907.048   1660.351   2292.235
 -121.8143    36.6509   1000.000     43.756    313.533        cca   3495.058   2016.773   2345.883       none      0.000      0.000      0.000      crust   3495.058   2016.773   2345.883
 -121.8143    36.6509   3000.000     43.756    313.533        cca   5641.688   3388.278   2662.988       none      0.000      0.000      0.000      crust   5641.688   3388.278   2662.988
 -121.8143    36.6509   5000.000     43.756    313.533        cca   5890.569   3531.039   2723.986       none      0.000      0.000      0.000      crust   5890.569   3531.039   2723.986
Using Geo Elevation coordinates as z mode.
 -118.7950    36.4140   1806.117   1798.774    710.100       none      0.000      0.000      0.000       none      0.000      0.000      0.000       none      0.000      0.000      0.000
 -118.7950    36.4140   1806.000   1798.774    710.100       none      0.000      0.000      0.000       none      0.000      0.000      0.000       none      0.000      0.000      0.000
 -118.7950    36.4140   1306.117   1798.774    710.100        cca   5370.107   3051.432   2543.331       none      0.000      0.000      0.000      crust   5370.107   3051.432   2543.331
 -118.7950    36.4140    806.117   1798.774    710.100        cca   5346.304   3037.022   2538.976       none      0.000      0.000      0.000      crust   5346.304   3037.022   2538.976
 -118.7950    36.4140  -1193.883   1798.774    710.100        cca   5546.554   3173.306   2582.663       none      0.000      0.000      0.000      crust   5546.554   3173.306   2582.663
 -118.7950    36.4140  -3193.883   1798.774    710.100        cca   5953.551   3469.791   2697.118       none      0.000      0.000      0.000      crust   5953.551   3469.791   2697.118
 -120.0850    37.2060    112.967    122.967    517.530        cca   4283.417   2471.697   2411.101       none      0.000      0.000      0.000      crust   4283.417   2471.697   2411.101
 -120.0850    37.2060   -377.033    122.967    517.530        cca   4796.681   2786.662   2472.683       none      0.000      0.000      0.000      crust   4796.681   2786.662   2472.683
 -120.0850    37.2060   -877.033    122.967    517.530        cca   5097.260   2975.843   2521.169       none      0.000      0.000      0.000      crust   5097.260   2975.843   2521.169
 -120.0850    37.2060  -2877.033    122.967    517.530        cca   5459.453   3125.438   2566.677       none      0.000      0.000      0.000      crust   5459.453   3125.438   2566.677
 -120.0850    37.2060  -4877.033    122.967    517.530        cca   5519.877   3151.389   2575.254       none      0.000      0.000      0.000      crust   5519.877   3151.389   2575.254
 -121.4440    36.2370    232.856    239.454    385.100        cca   2746.663   1543.394   2269.382       none      0.000      0.000      0.000      crust   2746.663   1543.394   2269.382
 -121.4440    36.2370    232.756    239.454    385.100        cca   2746.939   1543.541   2269.405       none      0.000      0.000      0.000      crust   2746.939   1543.541   2269.405
 -121.4440    36.2370   -267.144    239.454    385.100        cca   4117.993   2273.728   2381.083       none      0.000      0.000      0.000      crust   4117.993   2273.728   2381.083
 -121.4440    36.2370   -767.144    239.454    385.100        cca   4840.348   2873.715   2493.991       none      0.000      0.000      0.000      crust   4840.348   2873.715   2493.991
 -121.4440    36.2370  -2767.144    239.454    385.100        cca   5827.199   3487.582   2704.794       none      0.000      0.000      0.000      crust   5827.199   3487.582   2704.794
 -121.4440    36.2370  -4767.144    239.454    385.100        cca   5957.326   3561.197   2737.621       none      0.000      0.000      0.000      crust   5957.326   3561.197   2737.621
 -120.4870    34.2220   -252.000   -252.000    180.000       none      0.000      0.000      0.000       none      0.000      0.000      0.000       none      0.000      0.000      0.000
 -120.4870    34.2220   -252.500   -252.000    180.000        cca   5104.531   2872.584   2493.487       none      0.000      0.000      0.000      crust   5104.531   2872.584   2493.487
 -120.4870    34.2220   -752.000   -252.000    180.000        cca   5104.811   2872.500   2493.466       none      0.000      0.000      0.000      crust   5104.811   2872.500   2493.466
 -120.4870    34.2220  -1252.000   -252.000    180.000        cca   5118.893   2880.458   2495.493       none      0.000      0.000      0.000      crust   5118.893   2880.458   2495.493
 -120.4870    34.2220  -3252.000   -252.000    180.000        cca   5374.364   3041.156   2540.214       none      0.000      0.000      0.000      crust   5374.364   3041.156   2540.214
 -120.4870    34.2220  -5252.000   -252.000    180.000        cca   5625.756   3174.824   2583.164       none      0.000      0.000      0.000      crust   5625.756   3174.824   2583.164
 -121.8143    36.6509     43.731     43.756    313.533        cca   2482.309   1418.086   2241.779       none      0.000      0.000      0.000      crust   2482.309   1418.086   2241.779
 -121.8143    36.6509   -496.269     43.756    313.533        cca   2954.118   1688.882   2296.529       none      0.000      0.000      0.000      crust   2954.118   1688.882   2296.529
 -121.8143    36.6509   -956.269     43.756    313.533        cca   3495.094   2016.795   2345.886       none      0.000      0.000      0.000      crust   3495.094   2016.795   2345.886
 -121.8143    36.6509  -2956.269     43.756    313.533        cca   5641.691   3388.280   2662.989       none      0.000      0.000      0.000      crust   5641.691   3388.280   2662.989
 -121.8143    36.6509  -4956.269     43.756    313.533        cca   5890.570   3531.039   2723.986       none      0.000      0.000      0.000      crust   5890.570   3531.039   2723.986
EOF_EXPECTED_RESULT

echo "Running examples_programs_ucvm ucvm_query_cca_c"
if diff $result $expect > /dev/null 2>&1
then
  echo [SUCCESS]
else
  echo [FAILURE]
fi

trap 'rm -f "$expect" "$result"' exit

